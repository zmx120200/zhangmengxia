<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.zhangmengxia.mapper.BookMapper">
    <select id="getBookList" resultType="org.example.zhangmengxia.entity.Book">
        select * from book
    </select>
    
    <select id="getBookListByPage" resultType="org.example.zhangmengxia.entity.Book">
        select * from book limit #{start}, #{pageSize}
    </select>
    
    <select id="getBookTotalCount" resultType="int">
        select count(*) from book
    </select>
    
    <select id="getBookById" resultType="org.example.zhangmengxia.entity.Book">
        select * from book where book_id = #{id}
    </select>
    
    <insert id="addBook" parameterType="org.example.zhangmengxia.entity.Book" useGeneratedKeys="true" keyProperty="bookId">
        insert into book (book_name, author, isbn, publisher, publish_date, category, price, stock, location, description, cover_image, create_time, update_time)
        values (#{bookName}, #{author}, #{isbn}, #{publisher}, #{publishDate}, #{category}, #{price}, #{stock}, #{location}, #{description}, #{coverImage}, #{createTime}, #{updateTime})
    </insert>
    
    <update id="updateBook" parameterType="org.example.zhangmengxia.entity.Book">
        update book set
            book_name = #{bookName},
            author = #{author},
            isbn = #{isbn},
            publisher = #{publisher},
            publish_date = #{publishDate},
            category = #{category},
            price = #{price},
            stock = #{stock},
            location = #{location},
            description = #{description},
            cover_image = #{coverImage},
            update_time = #{updateTime}
        where book_id = #{bookId}
    </update>
    
    <delete id="deleteBook">
        delete from book where book_id = #{id}
    </delete>
    
    <select id="searchBooks" resultType="org.example.zhangmengxia.entity.Book">
        select * from book 
        where book_name like concat('%', #{keyword}, '%') 
           or author like concat('%', #{keyword}, '%')
           or isbn like concat('%', #{keyword}, '%')
           or description like concat('%', #{keyword}, '%')
    </select>
    
    <select id="getBooksByCategory" resultType="org.example.zhangmengxia.entity.Book">
        select * from book where category = #{category}
    </select>
    
    <select id="getAllCategories" resultType="java.lang.String">
        select distinct category from book where category is not null and category != '' order by category
    </select>
</mapper>
